<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enterprise • DC • AI — Rolling News</title>
<style>
  html, body { height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  body { background:#0b0f14; color:#e6edf3; }
  .wrap { display:flex; flex-direction:column; height:100%; }
  header { padding:10px 16px; font-size:18px; letter-spacing:.04em; background:#0f1620; position:sticky; top:0; z-index:2; }
  header .ts { opacity:.7; font-size:14px; }
  main { flex:1; display:flex; align-items:center; justify-content:center; padding:16px; }
  .card { width:100%; max-width:860px; border-radius:16px; background:#0f1620; box-shadow:0 10px 30px rgba(0,0,0,.35); padding:22px 24px; }
  .kicker { font-size:14px; text-transform:uppercase; letter-spacing:.14em; opacity:.7; margin-bottom:8px; }
  .title { font-size:28px; line-height:1.2; margin:0 0 10px; }
  .meta { font-size:13px; opacity:.7; margin-bottom:12px; }
  .summary { font-size:18px; line-height:1.45; }
  .bullets { margin:12px 0 0 0; padding:0 0 0 18px; }
  .bullets li { margin:6px 0; }
  footer { display:flex; gap:10px; align-items:center; justify-content:space-between; padding:12px 16px; background:#0b0f14; border-top:1px solid #101826; }
  .btn { font-size:14px; padding:10px 14px; border-radius:999px; background:#1a2332; color:#e6edf3; border:0; cursor:pointer; }
  .status { font-size:12px; opacity:.7; }
  a { color:#8ab4ff; text-decoration:none; } a:hover { text-decoration:underline; }
  .ticker { position:fixed; bottom:0; left:0; width:100%; background:#0f1620; border-top:1px solid #101826; white-space:nowrap; overflow:hidden; }
  .ticker-inner { display:inline-block; padding:8px 0; animation:scrollLeft 60s linear infinite; }
  .tick { display:inline-block; padding:0 24px; font-size:14px; opacity:.85; }
  @keyframes scrollLeft { from { transform: translateX(0); } to { transform: translateX(-50%); } }
  @media (max-width:480px){ .title{font-size:22px} .summary{font-size:16px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div><strong>Enterprise • Data Center • AI</strong> — Rolling News Display</div>
    <div class="ts" id="ts">Loading…</div>
  </header>
  <main>
    <article class="card" id="card" aria-live="polite">
      <div class="kicker" id="kicker">Just a sec…</div>
      <h1 class="title" id="title">Loading…</h1>
      <div class="meta" id="meta"></div>
      <div class="summary" id="summary"></div>
      <ul class="bullets" id="bullets"></ul>
    </article>
  </main>
  <footer>
    <div>
      <button class="btn" id="prevBtn">◀ Prev</button>
      <button class="btn" id="pauseBtn">⏸ Pause</button>
      <button class="btn" id="nextBtn">Next ▶</button>
    </div>
    <div class="status" id="status">—</div>
  </footer>
  <div class="ticker" aria-hidden="true"><div class="ticker-inner" id="ticker"></div></div>
</div>

<script>
/* ... keep your existing helpers ... */

// Add these light-weight helpers (ES5-safe)
function norm(s){ return String(s||'').toLowerCase().replace(/[^a-z0-9 ]+/g,' ').replace(/\s+/g,' ').trim(); }
function overlapRatio(a,b){
  var wa = norm(a).split(' '), wb = norm(b).split(' ');
  var set = {}, inter = 0, i;
  for(i=0;i<wa.length;i++) set[wa[i]] = 1;
  for(i=0;i<wb.length;i++) if(set[wb[i]]) inter++;
  var denom = Math.max(wa.length, wb.length) || 1;
  return inter / denom; // 0..1
}

function bulletsFrom(title, text){
  var s = (text || title || '');
  // Prefer real sentences
  var parts = textOnly(s).split(/(?<=[.!?])\s+/);
  if (parts.length < 2) {
    // fallback: break on commas/semicolons if needed
    parts = textOnly(s).split(/[;,]\s+/);
  }
  // clean + filter
  var cleaned = [];
  for (var i=0;i<parts.length;i++){
    var seg = parts[i].trim();
    if (seg.length < 20) continue;                  // too short
    if (overlapRatio(seg, title) > 0.8) continue;   // too close to the headline
    // de-dup by similarity to items we already kept
    var tooClose = false;
    for (var j=0;j<cleaned.length;j++){
      if (overlapRatio(seg, cleaned[j]) > 0.8) { tooClose = true; break; }
    }
    if (!tooClose) cleaned.push(seg);
    if (cleaned.length >= 4) break;
  }
  // Ensure 3–4 bullets; backfill with trimmed slices if needed
  while (cleaned.length < 3 && s.length > 0) {
    var w = textOnly(s).split(/\s+/);
    var slice = w.slice(0, Math.min(14, w.length)).join(' ');
    if (slice.length >= 20) cleaned.push(slice + (w.length>14?'…':''));
    else break;
  }
  return cleaned.slice(0, 4);
}

// If you have a buildItem() that creates the final object, make sure it calls bulletsFrom(title, summary):
function buildItem(raw){
  var title = raw.title;
  var sum = clamp50(raw.summary || raw.title);
  var bullets = bulletsFrom(title, sum);
  return { title: title, link: raw.link, source: raw.source, summary: sum, bullets: bullets, published: raw.published };
}
</script>
</body>
</html>
